name: "RTL-HAOS"
description: "RTL-SDR to Home Assistant MQTT bridge with signal diagnostics and system monitoring"
version: "1.2.0-rc.2"
slug: rtl-haos
url: "https://github.com/jaronmcd/rtl-haos"
arch:
  - amd64
  - aarch64
  - armv7
init: false
usb: true
uart: true
startup: services
boot: auto
options:
  mqtt_host: core-mosquitto
  mqtt_port: 1883
  mqtt_user: ""
  mqtt_pass: ""
  gas_unit: ft3
  bridge_id: "42"                   
  bridge_name: "rtl-haos-bridge"
  rtl_expire_after: 600
  rtl_throttle_interval: 30
  debug_raw_json: false
  rtl_show_timestamps: false
  verbose_transmissions: false  # Log every single MQTT publish

  # Advanced: pass through extra rtl_433 flags and/or a config file.
  # rtl_433_args acts as a GLOBAL OVERRIDE: if it includes an option that is also
  # set by per-radio settings or auto defaults (e.g. -s/-f/-d/-H/-R), the global
  # value wins and RTL-HAOS logs a WARNING per radio.
  # NOTE: RTL-HAOS requires JSON output; -F json is enforced (non-JSON lines are ignored).
  rtl_433_args: ""
  rtl_433_config_path: ""
  rtl_433_config_inline: ""
  rtl_433_bin: "rtl_433"

  # --- Battery alert behavior (battery_ok -> Battery Low) ---
  # 0 disables latching and clears low on the next OK
  battery_ok_clear_after: 300
  
  # --- DEFAULTS (Add-on UI) ---
  # Global defaults are NOT exposed in the add-on UI.
  # In add-on mode, use rtl_config below to set freq/rate/hop per-radio.
  # Standalone users may still override defaults via .env (RTL_DEFAULT_FREQ, etc.).
  
  # --- Advanced Radio Configuration ---
  rtl_config: []

  # --- Auto Multi-Radio (Zero-Clutter UI) ---
  # If rtl_config is empty, RTL-HAOS will auto-start 1-3 radios depending on how many
  # RTL-SDR dongles are detected.
  #
  # The ONLY user-facing knob in auto mode is the "Region / Band Plan" dropdown.
  # If you want to control rates / hopping / exact frequencies, define rtl_config
  # manually (and you are responsible for the full radio config).
  rtl_auto_band_plan: "auto"

  # --- Device Filtering ---
  # Define device patterns to allow or disallow.
  # Patterns use shell-style glob matching (Python fnmatch): *, ?, and [] character classes.
  # Patterns are matched against the decoded device's ID, model, and type fields.
  # Matching is case-insensitive.
  # Regular expressions (e.g. ^...$) are not supported.
  # Examples:
  # - "Cotech-367959"   # exact model
  # - "Cotech*"        # model prefix
  # - "101"            # exact ID
  # - "*8675*"         # substring match (model or ID)
  device_blacklist:
    - "SimpliSafe*"
    - "EezTire*"
  device_whitelist: []

schema:
  gas_unit: str
  mqtt_host: str
  mqtt_port: port
  mqtt_user: str
  mqtt_pass: password
  bridge_id: str
  bridge_name: str
  rtl_expire_after: int
  rtl_throttle_interval: int
  debug_raw_json: bool
  rtl_show_timestamps: bool
  verbose_transmissions: bool

  # Advanced rtl_433 passthrough
  rtl_433_args: str?
  rtl_433_config_path: str?
  rtl_433_config_inline: str?
  rtl_433_bin: str?

  # Auto multi-radio (when rtl_config is empty)
  rtl_auto_band_plan: list(auto|us|eu|world)

  battery_ok_clear_after: int

  # --- DELETED GLOBAL SCHEMA ---
  # The UI will no longer show the 3 text boxes for defaults.

  rtl_config:
    - name: str
      freq: str
      id: str?
      rate: str?
      hop_interval: int?

      # Optional rtl_tcp mode (network SDR).
      # If set, rtl_433 is invoked with: -d rtl_tcp:<tcp_host>:<tcp_port>
      tcp_host: str?
      tcp_port: port?

      # Optional per-radio protocol filter (rtl_433 -R).
      # Provide a comma-separated list, e.g. "104,105".
      # NOTE: We intentionally model this as a string to keep it truly optional
      # in the Home Assistant Supervisor UI. Nested lists inside list-of-dicts
      # are treated as required containers by Supervisor schema validation.
      protocols: str?

      # Advanced per-radio rtl_433 passthrough
      # - device: overrides -d (index/serial/Soapy selectors supported)
      # - args: extra rtl_433 flags (appended after freq/rate defaults)
      # - config_path/config_inline: provide an rtl_433 config file via -c
      device: str?
      args: str?
      config_path: str?
      config_inline: str?
      bin: str?

  device_blacklist:
    - str
  device_whitelist:
    - str
services:
  - mqtt:want
map:
  - config
  - share
